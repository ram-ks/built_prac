(function(e,t){var n={Base:"https://api.built.io/v1",register:"/application/users/",login:"/application/users/login/",logout:"/application/users/logout/",user:"/application/users/",getUserInfo:"/application/users/current/",classes:"/classes/",objects:"/objects/",upload:"/uploads/",version:"/v1/",host:"api.built.io",proto:"https://",forgetPassword:"/application/users/forgot_password/request_password_reset/",role:"/built_io_application_user_role/objects/",notification:"/push/",extensionURL:"https://api.built.io/v1/functions/"},r,s="only_network",o=null,u,a,f,l=false,c=typeof exports!=="undefined"&&typeof module!=="undefined"&&typeof module.exports!=="undefined"&&typeof navigator==="undefined"?true:false;if(c){r=exports;a=require("request");f=require("fs")}else{r=e.Built={}}r.VERSION="1.1.7";if(typeof console==="undefined"){console={log:function(){}}}var h={},p={},d=true,v=function(){return Math.floor(Math.random()*123456789)},m=function(e){return e.replace(/[\/]+/g,"/").replace(":/","://").replace(/[\/]$/,"")},g=function(e){for(var t in e){return false}return true},y=function(e,t){var n=this;var i;if(e&&Object.prototype.hasOwnProperty.call(e,"constructor")){i=e.constructor}else{i=function(){return n.apply(this,arguments)}}r.Util.extend(i,n,t);var s=function(){this.constructor=i};s.prototype=n.prototype;i.prototype=new s;if(e)r.Util.extend(i.prototype,e);i.__super__=n.prototype;return i},b=function(e){var t=new r.Promise;var n={};t.onSuccess=t.success;t.onError=t.error;t.onAlways=t.always;if(r.Util.dataType(e)=="object"){n=r.Util.clone(e);t.onSuccess(n.onSuccess);t.onSuccess(n.success);t.onError(n.onError);t.onError(n.error);t.onAlways(n.onAlways);t.onAlways(n.always)}n.onSuccess=n.success=t.resolve;n.onError=n.error=t.reject;t.__options=n;return t};(function(e){var t=e;t.initialize=function(e,n){h={},p={},o=null;if(typeof e=="object"){if(e.application_api_key&&e.application_uid){h["application_api_key"]=e.application_api_key;h["application_uid"]=e.application_uid}}else{if(typeof e=="string"){h["application_api_key"]=e}if(typeof n=="string"){h["application_uid"]=n}}return t};t.init=t.initialize;t.setTenant=function(e){if(typeof e=="string"){t.setHeaders("tenant_uid",e)}return t};t.removeTenant=function(){if(h["tenant_uid"]){delete h["tenant_uid"]}return t};t.fn=t.__proto__?t.__proto__:t.prototype;t.removeHeader=function(e){if(typeof e=="string"&&e!==""&&e!="authtoken"&&h[e]){delete h[e]}return t};t.setHeaders=function(e,n){if(e=="authtoken"){return t}if(t.Util.dataType(e)=="object"){var r=t.Util.clone(e);try{delete r.authtoken}catch(i){}h=t.Util.mix(h,r)}else if(typeof e=="string"&&typeof n=="string"){h[e]=n}return t};t.getHeaders=function(){return t.Util.clone(h)};t.setURL=function(e,r){if(e){n.host=e}if(typeof r=="string"&&r.indexOf("https")>=0){n.proto="https://"}else if(typeof r=="string"&&r.indexOf("http")>=0){n.proto="http://"}n.Base=m(n.proto+n.host+n.version);return t};t.addQueryString=function(e,n){if(typeof e=="string"&&typeof n=="string"){if(n==""&&p[e]){delete p[e];return}p[e]=n}return t};t.fallbackForCORS=function(e){if(t.Util.dataType(e)=="boolean"){d=e}return t}})(r);(function(e){var n=e;n.Util={};n.Util.parallel=function(e,t){if(this.dataType(e)=="object"){var n=this;var r=function(){var r=0,i=0,s=null,o={};for(var u in e){r+=1}var a=function(e){var n=e,u=function(){return function(e,u){if(e!=null){if(s==null&&typeof t=="function"){t(e,null);s=true}e=s}else{i+=1;o[n]=u;if(i>=r&&typeof t=="function"){t(s,o)}}}};return new u};for(var u in e){e[u](a(u))}return n};return new r}else{throw new Error("object parameter required for parallel tasks")}return this};n.Util.param=function(e,t){var n=[],r,i=/%20/g,s=function(e,r){r=r==null?"":r;if(t){n[n.length]=e+"="+r}else{n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(r)}};if(this.dataType(e)=="object"){for(var r in e){this.__buildParams__(r,e[r],s)}}else{var o=JSON.parse(e);for(var r in o){this.__buildParams__(r,o[r],s)}}return n.join("&").replace(i,"+")};n.Util.__buildParams__=function(e,t,n){var r=/\[\]$/;if(this.dataType(t)=="array"){for(var i=0;i<t.length;i++){if(r.test(e)){n(e,t[i])}else{this.__buildParams__(e+"["+(isNaN(i)?i:"")+"]",t[i],n)}}}else if(this.dataType(t)=="object"){for(name in t){this.__buildParams__(e+"["+name+"]",t[name],n)}}else{n(e,t)}};n.Util.dataType=function(e){var n=Object.prototype.toString.call(e);if(e===t){return"undefined"}else if(e===null){return"null"}else if(n.indexOf("Element")>=0||typeof e.tagName!=="undefined"){return"element"}else if(n=="[object Boolean]"){return"boolean"}else if(n=="[object Array]"){return"array"}else if(n=="[object Object]"){return"object"}else if(n=="[object Function]"){return"function"}else if(n=="[object Number]"||isNaN(e)==false&&e!=""){return"number"}else if(n=="[object String]"){return"string"}else{return"unknown"}};n.Util.mix=function(e,t){if(typeof e=="object"&&typeof t=="object"){var n=this.clone(e);for(var r in t){n[r]=t[r]}return n}};n.Util.clone=function(e){var t={};for(var n in e){t[n]=e[n]}return t};n.Util.each=function(e,t,n){var r=Array.prototype.forEach,i={};if(e==null)return;if(r&&e.forEach===r){e.forEach(t,n)}else if(e.length===+e.length){for(var s=0,o=e.length;s<o;s++){if(t.call(n,e[s],s,e)===i)return}}else{for(var u in e){if(e[u]){if(t.call(n,e[u],u,e)===i)return}}}};n.Util.extend=function(e){var t=Array.prototype.slice;this.each(t.call(arguments,1),function(t){if(t){for(var n in t){e[n]=t[n]}}});return e};n.Util.deparam=function(e,n){try{var r={},i={"true":!0,"false":!1,"null":null};var s=e.replace(/\+/g," ").split("&");var o=s.length;for(var u=0;u<o;u++){var a=s[u].split("="),f=decodeURIComponent(a[0]),l,c=r,h=0,p=f.split("]["),d=p.length-1;if(/\[/.test(p[0])&&/\]$/.test(p[d])){p[d]=p[d].replace(/\]$/,"");p=p.shift().split("[").concat(p);d=p.length-1}else{d=0}if(a.length===2){l=decodeURIComponent(a[1]);if(n){l=l&&!isNaN(l)?+l:l==="undefined"?t:i[l]!==t?i[l]:l}if(d){for(;h<=d;h++){f=p[h]===""?c.length:p[h];c=c[f]=h<d?c[f]||(p[h+1]&&isNaN(p[h+1])?{}:[]):l}}else{if(this.dataType(r[f])=="array"){r[f].push(l)}else if(r[f]!==t){r[f]=[r[f],l]}else{r[f]=l}}}else if(f){r[f]=n?t:""}}return r}catch(v){throw v}};n.Util.random=function(){return Math.floor(Math.random()*Date.now())};n.Util.trim=function(e){return e.replace(/^\s+|\s+$/g,"")}})(r);(function(e){var t=e;t.Events={__makeSure:function(e){if(!this.__listeners||typeof this.__listeners!=="object"){this.__listeners={}}if(!this.__listeners[e]||typeof this.__listeners[e]!=="object"){this.__listeners[e]=[]}return true},on:function(e,n,r){var i=this;if(typeof e=="string"&&e!=""&&typeof n=="function"){e=e.split(",");t.Util.each(e,function(e){e=t.Util.trim(e);if(e!=""){i.__makeSure(e);r=r||false;i.__listeners[e].push({callback:n,context:r,id:t.Util.random()})}})}return this},off:function(e,n){if(!e){r.__listeners={};return this}var r=this;e=e.split(",");t.Util.each(e,function(e){e=t.Util.trim(e);var i=r.__listeners[e];if(e&&i&&i.length){if(typeof n==="undefined"){delete r.__listeners[e]}else{for(var s=0;s<i.length;s++){if(n===i[s].callback){r.__listeners[e].splice(s,1)}}}}});return this},trigger:function(e){if(!this.__listeners||typeof this.__listeners!=="object"){return this}var n=this;e=e.split(",");t.Util.each(e,function(e){e=t.Util.trim(e);var r=n.__listeners[e];if(e&&r){var i=Array.prototype.slice.call(arguments,1);t.Util.each(r,function(e){if(typeof e.callback=="function"){var t=e.context||n;e.callback.apply(t,i)}})}});return this},inherit:function(e){e=e||{};var n=t.Util.clone(this);try{delete n.__listeners}catch(r){}return y.call(e,n)}};t.Events.bind=t.Events.on;t.Events.unbind=t.Events.off})(r);(function(e){var t=e;t.___fileInternals__=function(){var e={};this.add=function(t,n,r){if(t){e={file:t,attributes:n,options:r}}return this};this.upload=function(t){t=t||{};var r=this;if(g(e)==true){throw new Error("no file found")}var s=false;if(typeof e["options"]=="object"&&e["options"]["id"]){s=true}var o=e;var u=m(n.Base+n.upload+(s?o["options"]["id"]:"")),a=o["attributes"]||{},f=o["options"]||{},l=o["file"];return i(u,h,l,t,a,f)};var r=function(){var t={};for(var r in e){var s=false;if(typeof e[r]["options"]=="object"&&e[r]["options"]["id"]){s=true}t[r]=function(e,t){return function(r){var s=e["file"];var o={onSuccess:function(e,t){r(null,e)},onError:function(e,t){r(e,e)}};var u=m(n.Base+n.upload+(t?e["options"]["id"]:"")),a=e["attributes"]||{},f=e["options"]||{};i(u,h,s,o,a,f)}}(e[r],s)}return t};var i=function(e,t,r,i,o,u){if(n.host==""||typeof n.host!=="string"||n.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('api.built.io')")}i=i||{};var a=function(e,t){try{e=JSON.parse(e)}catch(n){}if(typeof e=="object"&&typeof e.notice!=="undefined"){if(typeof i.onSuccess=="function"){i.onSuccess(e.upload,t)}}else{if(typeof i.onError=="function"){i.onError(e,t)}}};if(c){return l(e,t,r,a,o,u)}return s(e,t,r,a,o,u)};var s=function(e,r,i,s,u,a){if(n.host==""||typeof n.host!=="string"||n.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}r=r||{};u=u||{};if(typeof window==="object"&&typeof window.FormData!=="undefined"){var f=new XMLHttpRequest,l;if(i instanceof FormData){l=i}else if(t.Util.dataType(i)=="element"){l=new FormData;if(i.getAttribute("type")=="file"){l.append("upload[upload]",i.files[0])}else{s({error_message:"input file element required"},null);throw new Error("input file element required")}}else if(typeof File!=="undefined"&&i instanceof File){l=new FormData;l.append("upload[upload]",i)}else{throw new Error("HTML input file element or FormData or File required")}var c={upload:{}};for(var h in u){c.upload[h]=u[h]}l.append("PARAM",JSON.stringify(c));if(a&&a.id){l.append("_method","put")}f.open("POST",e,true);if(t.Util.dataType(r)=="object"){for(var p in r){f.setRequestHeader(p,r[p])}}if(typeof s=="function"){f.onreadystatechange=function(n){if(f.readyState==4){if(f.status!=0){s(f.responseText,f)}else if(f.__aborted__){s({error_message:"request aborted"},f)}else{o(e,r,i,s,u,a)}t.Events.trigger("upload:end")}}}if(typeof a.onprogress=="function"&&typeof f.upload=="object"){f.upload.onprogress=a.onprogress}f.ontimeout=f.onerror=function(e){var n={error_message:"error occured",http:f,event:e};s(n,f);t.Events.trigger("upload:end");s=function(){}};f.__aborted__=false;f.send(l);t.Events.trigger("upload:start");return{_XHR:true,abort:function(){t.Events.trigger("upload:end");f.__aborted__=true;f.abort()}}}else{return o(e,r,i,s,u,a)}};var o=function(e,n,r,i,s,o){if(typeof r[0]!=="undefined"){r=r[0]}if(t.Util.dataType(r)=="element"){if(r.getAttribute("type")=="file"){var a=r.cloneNode();r.style.display="none";r.parentNode.insertBefore(a,r);var f="POST";var l=v().toString();if(typeof t.cbTray!="object"){t.cbTray={}}t.cbTray[l]=i;var c=k(e,n,r,f,l);var h=u(e,n,r,f,l,s,o);h.submit();t.Events.trigger("upload:start");return function(e){return{_XHR:false,abort:function(){t.Events.trigger("upload:end");if(typeof t.cbTray[e]==="function"){t.cbTray[e]=function(){try{delete t.cbTray[e]}catch(n){}};try{var n=document.getElementById("frame_"+e);n.parentNode.removeChild(n)}catch(r){}try{var i=document.getElementById("form_"+e);i.parentNode.removeChild(i)}catch(r){}}}}}(l)}else{i({error_message:"input file element required"},null);throw new Error("input file element required")}}else{i({error_message:"HTML input file element or FormData required for upload"},null);throw new Error("HTML input file element or FormData required for upload")}};var u=function(e,t,r,i,s,o,u){if(n.host==""||typeof n.host!=="string"||n.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}i=i.toUpperCase();var a=document.createElement("form");a.setAttribute("id","form_"+s);a.setAttribute("target","frame_"+s);a.setAttribute("method","post");a.setAttribute("height","0");a.setAttribute("width","0");a.setAttribute("style","display:none");a.setAttribute("enctype","multipart/form-data");a.setAttribute("encoding","multipart/form-data");e=m(e)+".postmessage";a.setAttribute("action",e);for(var f in t){try{a.appendChild(O(f.toString().toUpperCase(),t[f]))}catch(l){}}r.setAttribute("name","upload[upload]");a.appendChild(r);var c={upload:{}};for(var h in o){c.upload[h]=o[h]}a.appendChild(O("PARAM",JSON.stringify(c)));if(typeof u=="object"&&u.id){a.appendChild(O("_method","put"))}a.appendChild(O("postmessage_payload",s));a.appendChild(O("host",document.location.origin?document.location.origin:document.location.protocol+"//"+document.location.host));document.body.appendChild(a);return a};var l=function(e,n,r,i,s,o){n=n||{};s=s||{};var u=a.post(e,function(e,n,r){t.Events.trigger("upload:end");i(r,n)});t.Events.trigger("upload:start");var l=u.form();var c={upload:{}};for(var h in s){c.upload[h]=s[h]}l.append("PARAM",JSON.stringify(c));if(o&&o.id){l.append("_method","put")}for(var p in n){l.append(p.toString().toUpperCase(),n[p])}if(r.indexOf("://")>=0){l.append("upload[upload]",a(r))}else{l.append("upload[upload]",f.createReadStream(r))}return{_XHR:true,abort:function(){t.Events.trigger("upload:end");u.abort()}}}}})(r);(function(e){var t=e;t.File=function(e){var n;var r={};var i={};var s=null;if(typeof e=="string"){n=e;r.uid=e}else if(t.Util.dataType(e)=="object"&&typeof e["uid"]=="string"){r=e;n=e.uid}this.setFile=function(e){if(e){if(c){if(e.indexOf("://")>=0){i["upload"]=e;return this}else{if(f.existsSync(e)){if(f.statSync(e).isFile()){i["upload"]=e;return this}}throw new Error("invalid file path: "+e)}}else{if(typeof e[0]!=="undefined"){e=e[0]}if(t.Util.dataType(e)=="element"||typeof FormData!=="undefined"&&e instanceof FormData||typeof File!=="undefined"&&e instanceof File){i["upload"]=e}else{throw new Error("The parameter is not valid or not supported by the platform. Please pass an html input elment.")}}}else{throw new Error("file parameter required")}return this};this.addFile=this.setFile;this.setTags=function(e){var n=e;if(t.Util.dataType(n)==="array"){n=n.join(",")}if(n.indexOf(" ")>=0){n=n.split(" ").join(",")}i["tags"]=n;return this};this.setACL=function(e){if(typeof e=="object"&&typeof e.toJSON=="function"){var t=e.toJSON();i["ACL"]=t}else if(typeof e==="boolean"){i["ACL"]={disable:e}}return this};this.destroy=function(e){if(n){e=e||{};var t=this,s={},o=b(e);e=o.__options;var u=function(t,s){try{t=JSON.parse(t)}catch(o){}if(typeof t=="object"&&typeof t.notice!=="undefined"){n=null;r={};i={};if(typeof e.onSuccess=="function"){e.onSuccess(t,s)}}else{if(typeof e.onError=="function"){e.onError(t,s)}}};s.uid=n;var a=w.UPLOAD.destroy(h,{},u,s);o._XHR=a._XHR;o.abort=a.abort;return o}else{throw new Error("set upload uid")}};this.fetch=function(e){if(n){e=e||{};var t=this,s=b(e);e=s.__options;var o=function(t,s){try{t=JSON.parse(t)}catch(o){}if(typeof t=="object"&&typeof t.upload!=="undefined"){r=t.upload;n=r.uid;i={};if(typeof e.onSuccess=="function"){e.onSuccess(t,s)}}else{if(typeof e.onError=="function"){e.onError(t,s)}}};var u={uid:n};var a=w.UPLOAD.fetch(h,{},o,u);s._XHR=a._XHR;s.abort=a.abort;return s}else{throw new Error("set upload uid")}};this.get=function(e){if(typeof e=="string"){return r[e]}};this.setUid=function(e){if(typeof e=="string"){n=e;attribute.uid=e}return this};this.save=function(e){e=e||{};if(i["upload"]){var o=new t.___fileInternals__;var u={};var a={};var f=e.onSuccess;e.onSuccess=function(e,t){r=e;n=r.uid;i={};if(typeof f=="function"){f(e,t)}};var l=b(e);e=l.__options;if(i["tags"]){u.tags=i["tags"]}if(i["ACL"]){u.ACL=i["ACL"]}if(n){a["id"]=n}if(typeof s=="function"){a["onprogress"]=s}o.add(i["upload"],u,a);var c=o.upload(e);l._XHR=c._XHR;l.abort=c.abort;return l}else{throw new Error("no upload found")}};this.toJSON=function(){return t.Util.clone(r)};this.onProgress=function(e){if(typeof e=="function"){s=e}return this}};t.FileObject=t.File})(r);(function(e){var t=e;t.User={};t.User.login=function(e,n,r){r=r||{};if(typeof e!="string"||typeof n!="string"){return r.onError({error_message:"Email and Password required"},null)}var i=b(r);r=i.__options;var s=function(e,n){try{e=JSON.parse(e)}catch(i){}if(typeof e=="object"&&e.application_user){o=e.application_user;h["authtoken"]=e.application_user.authtoken;t.User.loginType="built";t.Events.trigger("user:login",e,"built");if(typeof r.onSuccess=="function"){r.onSuccess(e,n)}}else{if(typeof r.onError=="function"){r.onError(e,n)}}};var u={application_user:{email:e,password:n}};var a=w.USER.login(h,u,s,{});i._XHR=a._XHR;i.abort=a.abort;return i};t.User.update=function(e,t){t=t||{};e=e||{};var n=b(t);t=n.__options;if(o&&typeof o=="object"&&o.uid&&h.authtoken&&h.application_api_key&&h.application_uid){var r=function(e,n){try{e=JSON.parse(e)}catch(r){}if(typeof e=="object"&&e.notice){o=e.application_user;if(typeof t.onSuccess=="function"){t.onSuccess(e,n)}}else{if(typeof t.onError=="function"){t.onError(e,n)}}};var i=w.USER.update(h,e,r,o);n._XHR=i._XHR;n.abort=i.abort;return n}else{if(typeof t.onError=="function"){return t.onError({error_message:"Parameter missing"},null)}}};t.User.loginWithGoogle=function(e,n){if(typeof e=="string"){n=n||{};var r={onError:n.onError,onAlways:n.onAlways,onSuccess:function(e,r){t.User.__setUser__(e);t.User.loginType="google";t.Events.trigger("user:login",e,"google");if(typeof n.onSuccess=="function"){n.onSuccess(e,r)}}};var i=b(r);r=i.__options;var s=t.User.register({auth_data:{google:{access_token:e}}},r);i._XHR=s._XHR;i.abort=s.abort;return i}else{throw new Error("Google access token required for login")}return this};t.User.loginWithTibbr=function(e,n,r){if(typeof e=="string"&&typeof n=="string"){r=r||{};var i={onError:r.onError,onAlways:r.onAlways,onSuccess:function(e,n){t.User.__setUser__(e);t.User.loginType="tibbr";t.Events.trigger("user:login",e,"tibbr");if(typeof r.onSuccess=="function"){r.onSuccess(e,n)}}};var s=b(i);i=s.__options;var o=t.User.register({auth_data:{tibbr:{access_token:e,host:n}}},i);s._XHR=o._XHR;s.abort=o.abort;return s}else{throw new Error("tibbr access token and host required for login")}return this};t.User.loginWithFacebook=function(e,n){if(typeof e=="string"){n=n||{};var r={onError:n.onError,onAlways:n.onAlways,onSuccess:function(e,r){t.User.__setUser__(e);t.User.loginType="facebook";t.Events.trigger("user:login",e,"facebook");if(typeof n.onSuccess=="function"){n.onSuccess(e,r)}}};var i=b(r);r=i.__options;var s=t.User.register({auth_data:{facebook:{access_token:e}}},r);i._XHR=s._XHR;i.abort=s.abort;return i}else{throw new Error("Facebook access token required for login")}return this};t.User.loginWithTwitter=function(e,n){if(typeof e=="object"&&e.consumer_key&&e.consumer_secret&&e.token&&e.token_secret){n=n||{};var r={onError:n.onError,onAlways:n.onAlways,onSuccess:function(e,r){t.User.__setUser__(e);t.User.loginType="twitter";t.Events.trigger("user:login",e,"twitter");if(typeof n.onSuccess=="function"){n.onSuccess(e,r)}}};var i=b(r);r=i.__options;var s=t.User.register({auth_data:{twitter:{consumer_key:e.consumer_key,consumer_secret:e.consumer_secret,token:e.token,token_secret:e.token_secret}}},r);i._XHR=s._XHR;i.abort=s.abort;return i}else{throw new Error("Twitter Consumer key, Consumer Secret, Token, Token Secret required for login")}return this};t.User.saveSession=function(){if(typeof localStorage==="undefined"){return this}if(typeof o==="object"&&typeof localStorage!=="undefined"&&h["application_api_key"]){localStorage.setItem(h["application_api_key"],JSON.stringify(o));t.Events.trigger("user:save-session",o)}return this};t.User.setCurrentUser=function(e){if(typeof e=="object"&&e!=null&&e.authtoken){o=e;h["authtoken"]=e.authtoken;t.Events.trigger("user:set-current-user",o)}return this};t.User.getSession=function(){if(typeof h["application_api_key"]==="undefined"){throw new Error("initialize built.io sdk using Built.init(apiKey, appUid)")}try{if(localStorage.getItem(h["application_api_key"])){return JSON.parse(localStorage.getItem(h["application_api_key"]))}else{return null}}catch(e){return null}return null};t.User.clearSession=function(){o=null;try{delete h["authtoken"]}catch(e){}try{localStorage.removeItem(h["application_api_key"])}catch(e){}t.User.loginType=null;t.Events.trigger("user:clear-session");return this};t.User.logout=function(e){e=e||{};if(o==null||typeof o!="object"||typeof o.authtoken==="undefined"){throw new Error("no user found")}var n=b(e);e=n.__options;var r=function(n,r){try{n=JSON.parse(n)}catch(i){}if(typeof n=="object"&&typeof n.notice!=="undefined"){t.User.clearSession();t.Events.trigger("user:logout");if(typeof e.onSuccess=="function"){e.onSuccess(n,r)}}else{if(typeof e.onError=="function"){e.onError(n,r)}}};var i=w.USER.logout(h,{},r,{});n._XHR=i._XHR;n.abort=i.abort;return n};t.User.register=function(e,n){e=e||{};n=n||{};if((typeof e.email==="undefined"||typeof e.password==="undefined"||typeof e.password_confirmation==="undefined")&&typeof e.auth_data==="undefined"){throw new Error("missing required parameters. provide email, password, password_confirmation or auth_data");return}var r=b(n);n=r.__options;var i=function(e,r){try{e=JSON.parse(e)}catch(i){}if(typeof e=="object"&&typeof e.notice!=="undefined"){t.Events.trigger("user:register",e);if(typeof n.onSuccess=="function"){n.onSuccess(e,r)}}else{if(typeof n.onError=="function"){n.onError(e,r)}}},s={application_user:e};var o=w.USER.register(h,s,i,{});r._XHR=o._XHR;r.abort=o.abort;return r};t.User.activate=function(e,n,r){if(typeof e=="string"&&typeof n=="string"){r=r={};var i={userId:e,activationToken:n};var s=b(r);r=s.__options;var o=function(e,n){try{e=JSON.parse(e)}catch(i){}if(typeof e=="object"&&typeof e.notice!=="undefined"){t.Events.trigger("user:activate",e);if(typeof r.onSuccess=="function"){r.onSuccess(e,n)}}else{if(typeof r.onError=="function"){r.onError(e,n)}}};var u=w.USER.activate(h,{},o,i);s._XHR=u._XHR;s.abort=u.abort;return s}else{throw new Error("user uid and activation token required")}};t.User.deactivate=function(e,n){if(typeof h["authtoken"]==="undefined"){throw new Error("authenticated session required")}else if(typeof e!="string"){throw new Error("user uid required")}n=n||{};var r=b(n);n=r.__options;var i=function(e,r){try{e=JSON.parse(e)}catch(i){}if(typeof e=="object"&&typeof e.notice!=="undefined"){o=null;t.Events.trigger("user:deactivate",e);if(h["authtoken"]){delete h["authtoken"]}if(typeof n.onSuccess=="function"){n.onSuccess(e,r)}}else{if(typeof n.onError=="function"){n.onError(e,r)}}};var s=w.USER.deactivate(h,{},i,{userId:e});r._XHR=s._XHR;r.abort=s.abort;return r};t.User.isAuthenticated=function(){if(h["authtoken"]){return true}return false};t.User.getCurrentUser=function(){return t.Util.clone(o||{})};t.User.refreshUserInfo=function(e){e=e||{};if(typeof h["authtoken"]==="undefined"){throw new Error("no authtoken found");return}var t=b(e);e=t.__options;var n=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t=="object"&&t.application_user){var i=o.authtoken||h["authtoken"];o=t;o.authtoken=i;if(typeof e.onSuccess=="function"){e.onSuccess(o,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};var r=w.USER.fetchUserInfo(h,{},n,{});t._XHR=r._XHR;t.abort=r.abort;return t};t.User.requestResetPassword=function(e,t){t=t||{};if(typeof e!=="string"){throw new Error("email id required");return}var n=b(t);t=n.__options;var r=function(e,n){try{e=JSON.parse(e)}catch(r){}if(typeof e=="object"&&typeof e.notice!=="undefined"){if(typeof t.onSuccess=="function"){t.onSuccess(e,n)}}else{if(typeof t.onError=="function"){t.onError(e,n)}}};var i={application_user:{email:e}};var s=w.USER.forgetPassword(h,i,r,{});n._XHR=s._XHR;n.abort=s.abort;return n};t.User.loginWithGoogleNode=function(){return this};var n=function(e,t){var n=b(t);t=n.__options;var r=function(e,n){try{e=JSON.parse(e)}catch(r){}if(typeof e=="object"&&e.uid){if(typeof t.onSuccess=="function"){t.onSuccess(e,n)}}else{if(typeof t.onError=="function"){t.onError(e,n)}}};var i=w.USER.fetchUidByEmail(h,e,r);n._XHR=i._XHR;n.abort=i.abort;return n};t.User.fetchUserUidByEmail=function(e,t){if(typeof e=="string"){var r={application_user:{email:e}};t=t||{};return n(r,t)}else{throw new Error("email id required")}};t.User.fetchUserUidByGoogleEmail=function(e,t){if(typeof e=="string"){var r={application_user:{auth_data:{google:{email:e}}}};t=t||{};return n(r,t)}else{throw new Error("Google email id required")}};t.User.fetchUserUidByFacebookUserId=function(e,t){if(typeof e=="string"){var r={application_user:{auth_data:{facebook:{user_id:e}}}};t=t||{};return n(r,t)}else{throw new Error("facebook user id required")}};t.User.fetchUserUidByTibbrUserId=function(e,t,r){if(typeof e=="string"&&typeof t=="string"){var i={application_user:{auth_data:{tibbr:{user_id:e,host:t}}}};r=r||{};return n(i,r)}else{throw new Error("tibbr user id and host required")}return this};t.User.__setUser__=function(e){try{e=JSON.parse(e)}catch(t){}if(typeof e=="object"&&e.notice&&typeof e.application_user=="object"&&e.application_user.authtoken){o=e.application_user;h["authtoken"]=e.application_user.authtoken;return true}return false};t.User.loginType=null})(r);(function(e){var t=e;t.Delta=function(e){if(typeof e!="string"){throw new Error("class uid required for delta object")}var n={delta:{}};var r=e;this.createdAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["created_at"]=e;return this};this.deletedAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["deleted_at"]=e;return this};this.updatedAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["updated_at"]=e;return this};this.allDeltaAt=function(e){if(typeof r!="string"){throw new Error("class uid required")}if(typeof e!="string"){throw new Error("time param required to query delta objects")}n.delta["ALL"]=e;return this};this.exec=function(e){e=e||{};var i=this;if(typeof r!="string"){throw new Error("class uid required")}if(t.Util.dataType(n)!="object"||g(n)==true){throw new Error("no delta query found");return}var s=new t.Query(r);var o={};o.query=n;o.model=false;o.onSuccess=function(t,n){if(e.model===false){if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof t.objects.created_at!=="undefined"){t.objects.created_at=s.__toObjectModel__(t.objects.created_at,r)}if(typeof t.objects.updated_at!=="undefined"){t.objects.updated_at=s.__toObjectModel__(t.objects.updated_at,r)}if(typeof t.objects.deleted_at!=="undefined"){t.objects.deleted_at=s.__toObjectModel__(t.objects.deleted_at,r)}if(typeof e.onSuccess=="function"){e.onSuccess(t.objects,n)}}};o.onError=e.onError;o.onAlways=e.onAlways;return s.exec(o)}}})(r);(function(e){var n=e;n.Object=function(e,r){var i=null;var s={};var o=null;var u={};var a={};var f={};var l=n.Util.clone(h),c=this;if(e){if(this.class_uid&&arguments.length==1){if(typeof e=="string"){r={uid:e}}else{r=e}}else if(typeof e=="string"){this.class_uid=e}}if(typeof r=="string"&&r!==""){r={uid:r}}if(typeof this.class_uid!="string"){throw new Error("class uid required")}if(n.Util.dataType(r)=="object"){s=n.Util.clone(r);if(typeof r.uid=="string"&&r.uid!=""){o=r.uid}}this.initialize=function(){};this._validate=function(){if(typeof this.validate=="function"){return this.validate.apply(this,arguments)}return true};this.setTags=function(e){var t=e;if(n.Util.dataType(e)==="array"){t=t.join(",")}if(t.indexOf(" ")>=0){t=t.split(" ").join(",")}a["tags"]=t;return this};this.timeless=function(){l["timeless"]=true};this.upsert=function(e){if(typeof e==="string"&&val){if(typeof f["UPSERT"]==="undefined"){f["UPSERT"]={}}f["UPSERT"][e]=val}else if(n.Util.dataType(e)=="object"){if(typeof f["UPSERT"]==="undefined"){f["UPSERT"]={}}f["UPSERT"]=n.Util.mix(f["UPSERT"],e)}};this.upsertForReference=function(e,t){if(typeof e=="string"&&n.Util.dataType(t)=="object"){if(typeof a[e]!=="object"){a[e]={}}a[e]["UPSERT"]=t}return this};this.increment=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{ADD:t})}return this};this.decrement=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{SUB:t})}return this};this.multiply=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{MUL:t})}return this};this.divide=function(e,t){if(typeof e=="string"&&e!=""){t=isNaN(t)==true?1:t;this.set(e,{DIV:t})}return this};this.pushValue=function(e,t,r){if(typeof arguments[0]==="string"&&arguments[0]!=""){var i={PUSH:{}};var s=Array.prototype.slice.apply(arguments,[1,arguments.length]);for(var o=0,u=s.length;o<u;o++){var f=typeof s[o];if(f=="object"){if(typeof i["PUSH"]["data"]==="undefined"){i["PUSH"]["data"]=[]}i["PUSH"]["data"].push.apply(i["PUSH"]["data"],s[o])}else if(f=="number"){i["PUSH"]["index"]=s[o]}else if(f=="string"){if(typeof i["PUSH"]["data"]==="undefined"){i["PUSH"]["data"]=[]}i["PUSH"]["data"].push(s[o])}}if(typeof i["PUSH"]["data"]!=="undefined"||i["PUSH"]["index"]!=="undefined"){if(typeof a[e]==="undefined"){a[e]={}}a[e]=n.Util.mix(a[e],i)}}return this};this.pullValue=function(e,t){if(typeof e==="string"&&e!=""&&t){if(typeof a[e]==="undefined"){a[e]={}}if(typeof a[e]["PULL"]==="undefined"){a[e]["PULL"]={}}if(typeof a[e]["PULL"]["data"]==="undefined"){a[e]["PULL"]["data"]=[]}if(n.Util.dataType(t)=="array"){a[e]["PULL"]["data"]=a[e]["PULL"]["data"].concat(t)}else{a[e]["PULL"]["data"].push(t)}}return this};this.pullValueAtIndex=function(e,t){if(typeof e==="string"&&isNaN(t)==false){if(typeof a[e]==="undefined"){a[e]={}}if(typeof a[e]["PULL"]==="undefined"){a[e]["PULL"]={}}a[e]["PULL"]["index"]=parseInt(t)}return this};this.set=function(e,n){if(typeof e=="object"){for(var r in e){if(c._validate(r,e[r])){this.trigger("change, change:"+r,this,e[r],a[r]);a[r]=e[r]}}}else if(typeof e=="string"){if(c._validate(e,n)){this.trigger("change, change:"+e,this,n,a[e]);a[e]=n}}o=this.get("uid")||t;return this};this.setReferenceWhere=function(e,t){if(typeof e=="string"&&t){a[e]={WHERE:t}}return this};this.setReference=function(e,t){if(typeof e=="string"&&t){if(n.Util.dataType(a[e])!="array"){a[e]=[]}if(n.Util.dataType(t)=="array"){a[e]=a[e].concat(t)}else{a[e].push(t)}}return this};this.setLocation=function(e){if(e instanceof n.Location){var t=e.toJSON();this.set("__loc",[t.longitude,t.latitude])}else{throw new Error("Built.Location object required")}return this};this.getLocation=function(){return new n.Location(this.get("__loc"))};this.updateValue=function(e,t,n){if(typeof e=="string"&&isNan(n)==false&&t){a[e]={UPDATE:{data:t,index:n}}}return this};this.fetch=function(e){if(typeof this.class_uid!=="string"||this.class_uid.length<=0||typeof o!=="string"||o.length<=0){throw new Error("object uid and class uid required")}e=e||{};var t,n={};var r=b(e);e=r.__options;var i=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t=="object"&&typeof t.object!=="undefined"){s=t.object;o=t.object.uid;a={};c.trigger("fetch:data",t.object);if(typeof e.onSuccess=="function"){e.onSuccess(t.object,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};n.class_uid=this.class_uid;if(o){n.object_uid=o}var f=w.OBJECT.fetch(l,u,i,n);r._XHR=f._XHR;r.abort=f.abort;return r};this.saveAsDraft=function(e){this.set({published:false});return this.save(e)};this.includeFilter=function(e,t){if(typeof e=="string"&&t){u[e]=t}return this};this.setACL=function(e){if(typeof e=="object"&&typeof e.toJSON=="function"){var t=e.toJSON();this.set("ACL",t)}else if(typeof e==="boolean"){this.set("ACL",{disable:e})}return this};this.save=function(e){e=e||{};var t={};var r=b(e);e=r.__options;var i=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t=="object"&&typeof t.object!=="undefined"){s=t.object;o=t.object.uid;a={};c.trigger("save",t.object);if(typeof e.onSuccess=="function"){e.onSuccess(t.object,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};t.class_uid=this.class_uid;if(o){t.object_uid=o}if(typeof o=="string"&&o.length>0){var u=w.OBJECT.update(l,{object:a},i,t);r._XHR=u._XHR;r.abort=u.abort;return r}else{var h=n.Util.mix({object:a},f);var u=w.OBJECT.create(l,h,i,t);r._XHR=u._XHR;r.abort=u.abort;return r}return this};this.destroy=function(e){e=e||{};var t={};var n=b(e);e=n.__options;var r=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t=="object"&&typeof t.notice!=="undefined"){o=null;s={};a={};c.trigger("destroy",t);if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};t.class_uid=this.class_uid;if(o){t.object_uid=o;var i=w.OBJECT.destroy(l,{},r,t);n._XHR=i._XHR;n.abort=i.abort;return n}else{throw new Error("no object uid found")}return this};this.getSchema=function(e){e=e||{};var t=b(e);e=t.__options;var n=p(e,this);t._XHR=n._XHR;t.abort=n.abort;return t};var p=function(e,t){if(n.Util.dataType(i)=="array"){if(typeof e.onSuccess=="function"){e.onSuccess(i)}}var r={},s=e.onSuccess,o=function(n,r){try{n=JSON.parse(n)}catch(o){}if(typeof n=="object"&&n["class"]){i=n["class"].schema;t.trigger("fetch:schema",i);if(typeof s=="function"){s(i,r)}}else{if(typeof e.onError=="function"){e.onError(n,r)}}};e.onSuccess=o;r.class_uid=t.class_uid;return w["CLASS"].fetch(l,{},o,r)};this.has=function(e){return hasOwnProperty.call(s,e)};this.get=function(e){if(e){return typeof a[e]!=="undefined"?a[e]:typeof s[e]!=="undefined"?s[e]:t}return t};this.setUid=function(e){return this.set("uid",e)};this.clone=function(){return new this.constructor(s)};this.isNew=function(){return!o};this.toJSON=function(){var e=n.Util.clone(s);return n.Util.mix(e,a)};this.dirtyJSON=function(){return n.Util.clone(a)};this.oldJSON=function(){return n.Util.clone(s)};this.addHeader=function(e,t){if(e&&t&&typeof e=="string"&&typeof t=="string"){l[e]=t}return this};this.removeHeader=function(e){if(e&&typeof e=="string"&&l[e]){delete l[e]}return this}};n.Object=n.Events.inherit(n.Object);n.Object.ModelType={BACKBONE:"BACKBONE",NATIVE:"NATIVE",NONE:"NONE"};n.Object.BACKBONE="BACKBONE";n.Object.NATIVE="NATIVE";n.Object.NONE="NONE";n.Object.extend=function(e){if(typeof e=="string"){e={class_uid:e};return y.call(n.Object,e)}return y.apply(n.Object,arguments)}})(r);(function(e){var n=e;n.ACL=function(e){var r=e;var i={};if(typeof r!=="undefined"){if(r instanceof n.ACL){r=r.toJSON()}if(n.Util.dataType(r)!="object"){try{r=JSON.parse(r)}catch(s){}}if(n.Util.dataType(r)=="object"){i=r}}this.__getAccess=function(e,n,r){if(typeof e==="undefined"||typeof n==="undefined"||typeof r==="undefined"){return t}var s=i[e];if(typeof s!=="object"&&s!==t){return t}for(var o=0,u=s.length;o<u;o++){if(s[o].uid&&s[o].uid==r&&s[o][n]&&s[o][n]==true){return true}}return false};this.__setAccess=function(e,t,r,s){if(typeof e==="undefined"||typeof t==="undefined"||typeof r==="undefined"||typeof s==="undefined"){return}if(n.Util.dataType(s)=="boolean"&&r){var o=i[e];if(typeof o!=="object"){i[e]=[];o=i[e]}for(var u=0,a=o.length;u<a;u++){if(o[u].uid&&o[u].uid==r){o[u][t]=s;return}}var f={};f.uid=r;f[t]=s;i[e].push(f)}return this};this.__setOthers=function(e,t){if(n.Util.dataType(t)=="boolean"&&e){if(typeof i.others!=="object"){i.others={}}i.others[e]=t}return this};this.__getOthers=function(e){if(typeof i.others!=="object"){return false}return i.others[e]};this.__setDisable=function(e){if(typeof e==="boolean"){i["disable"]=e}return this};this.__isDisabled=function(){return i["disable"]};this.__getd=function(){return n.Util.clone(i)}};n.Util.extend(n.ACL.prototype,{getPublicReadAccess:function(){return this.__getOthers("read")},getPublicWriteAccess:function(){return this.__getOthers("update")},getPublicDeleteAccess:function(){return this.__getOthers("delete")},getUserReadAccess:function(e){return this.__getAccess("users","read",e)},getUserWriteAccess:function(e){return this.__getAccess("users","update",e)},getUserDeleteAccess:function(e){return this.__getAccess("users","delete",e)},getRoleReadAccess:function(e){return this.__getAccess("roles","read",e)},getRoleWriteAccess:function(e){return this.__getAccess("roles","update",e)},getRoleDeleteAccess:function(e){return this.__getAccess("roles","delete",e)},setPublicReadAccess:function(e){if(n.Util.dataType(e)=="boolean"){this.__setOthers("read",e)}return this},setPublicWriteAccess:function(e){if(n.Util.dataType(e)=="boolean"){this.__setOthers("update",e)}return this},setPublicDeleteAccess:function(e){if(n.Util.dataType(e)=="boolean"){this.__setOthers("delete",e)}return this},setUserReadAccess:function(e,t){return this.__setAccess("users","read",e,t)},setUserWriteAccess:function(e,t){return this.__setAccess("users","update",e,t)},setUserDeleteAccess:function(e,t){return this.__setAccess("users","delete",e,t)},setRoleReadAccess:function(e,t){return this.__setAccess("roles","read",e,t)},setRoleWriteAccess:function(e,t){return this.__setAccess("roles","update",e,t)},setRoleDeleteAccess:function(e,t){return this.__setAccess("roles","delete",e,t)},disable:function(e){return this.__setDisable(e)},isDisabled:function(){return this.__isDisabled()},toJSON:function(){return this.__getd()}})})(r);(function(e){var n=e;n.Query=function(e){if(typeof e!="string"){throw new Error("class uid required")}var r=e;var o=s;var u=this,a=false;var f={};var l=[];var c=[];var p=null;var d=true;var v=n.Util.clone(h);var m=function(e,t,n,r){if(r){if(typeof f[r]==="undefined"){f[r]={}}if(typeof f[r][e]==="undefined"){f[r][e]={}}f[r][e][t]=n}return this};var g=function(e,t){if(typeof e=="object"){if(typeof e[t]!="object"){e[t]={}}}};var y=function(e){if(e&&e!=null&&typeof e=="object"){p=e;return p}else{if(typeof p==="object"&&p!=null&&p!=t&&p!=""){return p}return E()}};var E=function(){var e=f["query"]||null;var t=n.Util.clone(f);var r=false;if(l.length>0){t["query"]={};for(var i=0;i<l.length;i++){if(typeof t["query"]["$or"]!="object"){t["query"]["$or"]=[]}if(typeof l[i]!=="undefined"&&typeof l[i]["query"]=="object"){t["query"]["$or"].push(l[i]["query"])}}if(e!=null){t["query"]=n.Util.mix(t["query"],e)}}if(c.length>0){if(l.length<1){t["query"]={}}for(var i=0;i<c.length;i++){if(typeof t["query"]["$and"]!="object"){t["query"]["$and"]=[]}if(typeof c[i]!=="undefined"&&typeof c[i]["query"]=="object"){t["query"]["$and"].push(c[i]["query"])}}if(e!=null){t["query"]=n.Util.mix(t["query"],e)}}return t};this.__toObjectModel__=function(e,t){t=t||r;if(!t){throw new Error("class uid required")}var i=n.Object.extend(t),s=[],o;if(n.Util.dataType(e)=="array"){for(var u=0,a=e.length;u<a;u++){if(typeof e[u]=="object"&&e[u].uid&&typeof e[u].uid=="string"){s[s.length]=new i(e[u])}}return s}else if(n.Util.dataType(e)=="object"){if(typeof e=="object"&&e.uid&&typeof e.uid=="string"){o=new i(e);return o}return null}else{return null}};this.__toBackboneModel__=function(e,t){t=t||r;if(!t){throw new Error("class uid required")}var i="object";if(n.Util.dataType(e)=="array"){i="array";if(e.length==0){return e}}if(typeof Backbone!=="undefined"&&Backbone.Model&&Backbone.Collection){var s=Backbone.Model.extend({idAttribute:"uid",initialize:function(e){},sync:function(e,t,i){if(arguments.length==2){i=t;t={}}i=i||{};var s=new n.Object(r,this.toJSON());s.set(this.changed);if(e=="read"){return s.fetch(i)}else if(e=="create"||e=="update"){return s.save(i)}else if(e=="delete"){return s.destroy(i)}return null}});if(i=="object"){return new s(e)}else{var o=Backbone.Collection.extend({model:s,sync:function(e,t,i){if(arguments.length==2){i=t;t={}}i=i||{};var s=new n.Object(r,this.toJSON());s.set(this.changed);if(e=="read"){var o=new n.Query(r);return o.exec(i)}return null}});o=new o;for(var u=0,a=e.length;u<a;u++){if(typeof e[u]=="object"){o.add(new s(e[u]))}}return o}}else{return this.__toObjectModel__(e,r)}};this.modelType=function(e){d=e;return this};this.setModelType=function(e){d=e;return this};this.setCachePolicy=function(e){o=e;return u};this.getClassUid=function(){return r};this.addHeader=function(e,t){if(e&&t&&typeof e=="string"&&typeof t=="string"){v[e]=t}return this};this.removeHeader=function(e){if(e&&typeof e=="string"&&v[e]){delete v[e]}return this};this.exec=function(e){if(typeof r!="string"){throw new Error("class uid required")}e=e||{};var t=this,n={},i=e.query||y();n.class_uid=e.class_uid||r;var s=JSON.stringify(v)+n.class_uid+JSON.stringify(i);try{i=JSON.parse(i)}catch(a){}var f=b(e);e=f.__options;f.__preserve(true);var l=function(){var n=D.encode(s);var r=P.get(n);var i={type:"CACHE"};if(r){try{r=JSON.parse(r);if(d==="BACKBONE"){var a=typeof r.objects!=="undefined"?r.objects:typeof r.object!=="undefined"?r.object:r;if(typeof e.onSuccess=="function"){var f=t.__toBackboneModel__(a,u.class_uid);for(var l in r){if(l!=="object"&&l!=="objects"){f[l]=r[l]}}e.onSuccess(f,i)}}else if(e.model===false||d=="NONE"){if(typeof e.onSuccess=="function"){e.onSuccess(r,i)}}else{var a=typeof r.objects!=="undefined"?r.objects:typeof r.object!=="undefined"?r.object:[];if(typeof e.onSuccess=="function"){var f=t.__toObjectModel__(a,t.class_uid);for(var l in r){if(l!=="object"&&l!=="objects"){f[l]=r[l]}}e.onSuccess(f,i)}}if(o=="only_cache"||o=="cache_else_network"){return{_XHR:null,abort:function(){}}}}catch(c){if(typeof e.onError=="function"){e.onError({error_message:"no cache found"},i)}}}else{if(o=="cache_else_network"&&typeof h=="function"){return h()}else if(typeof e.onError=="function"){e.onError({error_message:"no cache found"},i)}}if(o=="cache_then_network"&&typeof h==="function"){return h()}};var c=function(n,r){r=r||{};try{n=JSON.parse(n)}catch(i){}try{r["type"]="NETWORK"}catch(i){}if(typeof n=="object"&&typeof n.objects!=="undefined"){if(o!="only_network"){P.set(D.encode(s),JSON.stringify(n))}var u=typeof n.objects!=="undefined"?n.objects:typeof n.object!=="undefined"?n.object:[];if(d==="BACKBONE"){if(typeof e.onSuccess=="function"){var a=t.__toBackboneModel__(u);for(var f in n){if(f!=="object"&&f!=="objects"){a[f]=n[f]}}e.onSuccess(a,r)}}else if(e.model===false||d==="NONE"){if(typeof e.onSuccess=="function"){e.onSuccess(n,r)}}else{if(typeof e.onSuccess=="function"){var a=t.__toObjectModel__(u);for(var f in n){if(f!=="object"&&f!=="objects"){a[f]=n[f]}}e.onSuccess(a,r)}}}else{if(typeof e.onError=="function"){e.onError(n,r)}}};var h=function(){return w.OBJECT.fetch(v,i,c,n)};if(o==="only_cache"){var p=l();f._XHR=p._XHR;f.abort=p.abort;return f}else if(o==="cache_else_network"){var p=l();f._XHR=p._XHR;f.abort=p.abort;return f}else if(o==="network_else_cache"){var m=e.onError;e.onError=function(){e.onError=m;return l()};var p=h();f._XHR=p._XHR;f.abort=p.abort;return f}else if(o==="cache_then_network"){var p=l();f._XHR=p._XHR;f.abort=p.abort;return f}else{var p=h();f._XHR=p._XHR;f.abort=p.abort;return f}};this.notInQuery=function(e,t){if(e&&t){var r,i={},s,o,u;if(t instanceof n.Query&&typeof t.toJSON==="function"){u=t.toJSON().query}else{u=t}if(e.indexOf(">")>=0){r=e.split(">");o=r[0];_count=e.length-1;for(var a=r.length;a>0;a--){if(r[a-1]!=""){s=i;i={};i[r[a-1]]={$nin_query:a==r.length?u:s}}}}else{i[e]={$nin_query:u}}if(typeof f["query"]!="object"){f["query"]={}}f["query"]=n.Util.mix(f["query"],i)}return this};this.inQuery=function(e,t){if(e&&t){var r,i={},s,o,u;if(t instanceof n.Query&&typeof t.toJSON==="function"){u=t.toJSON().query}else{u=t}if(e.indexOf(">")>=0){r=e.split(">");o=r[0];_count=e.length-1;for(var a=r.length;a>0;a--){if(r[a-1]!=""){s=i;i={};i[r[a-1]]={$in_query:a==r.length?u:s}}}}else{i[e]={$in_query:u}}if(typeof f["query"]!="object"){f["query"]={}}f["query"]=n.Util.mix(f["query"],i)}return this};this.tags=function(){f["tags"]=f["tags"]||[];for(i=0;i<arguments.length;i++){if(typeof arguments[i]=="string"){f["tags"]=f["tags"].concat(arguments[i].split(/[\s,]+/))}else if(n.Util.dataType(arguments[i])=="array"){f["tags"]=f["tags"].concat(arguments[i])}}return this};this.where=function(e,t){if(typeof f["query"]!="object"){f["query"]={}}f["query"][e]=t;return this};this.skip=function(e){if(n.Util.dataType(e)=="number"&&parseInt(e)>=0){f["skip"]=e}return this};this.limit=function(e){if(n.Util.dataType(e)=="number"&&parseInt(e)>0){f["limit"]=e}return this};this.includeSchema=function(){f["include_schema"]=true;return this};this.includeCount=function(){f["include_count"]=true;return this};this.includeOwner=function(){f["include_owner"]=true;return this};this.beforeUid=function(e){if(n.Util.dataType(e)=="string"){f["before_uid"]=e}return this};this.afterUid=function(e){if(n.Util.dataType(e)=="string"){f["after_uid"]=e}return this};this.includeDrafts=function(){f["include_unpublished"]=true;return this};this.onlyDrafts=function(){this.includeDrafts();if(typeof f["query"]!="object"){f["query"]={}}f.query["published"]=false;return this};this.notEqualTo=function(e,t){m(e,"$ne",t,"query");return this};this.lessThan=function(e,t){m(e,"$lt",t,"query");return this};this.greaterThan=function(e,t){m(e,"$gt",t,"query");return this};this.lessThanOrEqualTo=function(e,t){m(e,"$lte",t,"query");return this};this.greaterThanOrEqualTo=function(e,t){m(e,"$gte",t,"query");return this};this.containedIn=function(e,t){if(typeof t!="object"){t=[t]}m(e,"$in",t,"query");return this};this.notContainedIn=function(e,t){if(typeof t!="object"){t=[t]}m(e,"$nin",t,"query");return this};this.exists=function(e){m(e,"$exists",true,"query");return this};this.doesNotExist=function(e){m(e,"$exists",false,"query");return this};this.matches=function(e,t,n){if(typeof f["query"]==="undefined"){f["query"]={}}if(typeof f["query"][e]==="undefined"){f["query"][e]={}}f["query"][e]["$regex"]=t;if(n){f["query"][e]["$options"]=n}return this};this.include=function(e){if(n.Util.dataType(f["include"])!="array"){f["include"]=[]}if(n.Util.dataType(e)=="array"){for(var t=0,r=e.length;t<r;t++){f["include"].push(e[t])}}else{f["include"].push(e)}return this};this.only=function(e,t){if(typeof f["only"]!=="object"){f["only"]={}}if(typeof t==="string"){if(typeof f["only"][t]!=="object"){f["only"][t]=[]}if(n.Util.dataType(e)=="array"){f["only"][t]=f["only"][t].concat(e)}else{f["only"][t].push(e)}}else{if(typeof f["only"]["BASE"]!=="object"){f["only"]["BASE"]=[]}if(n.Util.dataType(e)=="array"){f["only"]["BASE"]=f["only"]["BASE"].concat(e)}else{f["only"]["BASE"].push(e)}}return this};this.except=function(e,t){if(typeof f["except"]!=="object"){f["except"]={}}if(typeof t==="string"){if(typeof f["except"][t]!=="object"){f["except"][t]=[]}if(n.Util.dataType(e)=="array"){f["except"][t]=f["except"][t].concat(e)}else{f["except"][t].push(e)}}else{if(typeof f["except"]["BASE"]!=="object"){f["except"]["BASE"]=[]}if(n.Util.dataType(e)=="array"){f["except"]["BASE"]=f["except"]["BASE"].concat(e)}else{f["except"]["BASE"].push(e)}}return this};this.includeFilter=function(e,t){if(typeof e=="string"&&t){f[e]=t}return this};this.ascending=function(e){if(typeof e=="string"){f["asc"]=e}return this};this.descending=function(e){if(typeof e=="string"){f["desc"]=e}return this};this.and=function(e){for(var t=0,r=arguments.length;t<r;t++){if(arguments[t]instanceof n.Query&&typeof arguments[t]["toJSON"]==="function"){c.push(arguments[t]["toJSON"]())}}return this};this.or=function(e){for(var t=0,r=arguments.length;t<r;t++){if(arguments[t]instanceof n.Query&&typeof arguments[t]["toJSON"]==="function"){l.push(arguments[t]["toJSON"]())}}return this};this.select=function(e,t,r){if(t instanceof n.Query&&typeof t["toJSON"]==="function"&&t.getClassUid()!=""&&t.getClassUid()!=="undefined"&&typeof r==="string"&&r!=""){if(typeof f["query"]!="object"){f["query"]={}}f["query"][e]={$select:{query:t.toJSON().query,class_uid:t.getClassUid(),key:r}}}else{throw new Error("incorrect parameter")}return this};this.dontSelect=function(e,t,r){if(t instanceof n.Query&&typeof t["toJSON"]==="function"&&t.getClassUid()!=""&&t.getClassUid()!=="undefined"&&typeof r==="string"&&r!=""){if(typeof f["query"]!="object"){f["query"]={}}f["query"][e]={$dont_select:{query:t.toJSON().query,class_uid:t.getClassUid(),key:r}}}else{throw new Error("incorrect parameter")}return this};this.nearLocation=function(e,t){t=t||1e3;g(f,"query");if(e instanceof n.Location&&typeof t=="number"){var r=e.toJSON();f["query"]["$near"]={coords:[r.longitude,r.latitude],radius:t}}else if(typeof e=="string"&&typeof t=="number"){f["query"]["$near"]={coords:[r.longitude,r.latitude],radius:t}}else{throw new Error("invalid parameter")}return this};this.withinLocation=function(e){g(f,"query");if(n.Util.dataType(e)=="array"){if(e.length<3){throw new Error("minimum 3 locations or objectUid required")}var t=[];for(var r=0;r<e.length;r++){if(e[r]instanceof n.Location){var i=e[r].toJSON();t.push([i.longitude,i.latitude])}else if(typeof e[r]=="string"){t.push({object:e[r]})}else{throw new Error("invalid parameter, "+i[r])}}f["query"]["$within"]=t}return this};this.toJSON=function(e){return y(e)};this.count=function(e){e=e||{};var t=b(e);e=t.__options;if(typeof r=="string"&&r.length>0){var n,i=this,s={};var o=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t=="object"&&typeof t.objects!=="undefined"){if(typeof e.onSuccess=="function"){e.onSuccess(t.objects,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};s.class_uid=r;var u=opt=y()||{};u.count=true;var a=w.OBJECT.fetch(v,u,o,s);t._XHR=a._XHR;t.abort=a.abort;return t}else{if(typeof e=="object"&&typeof e.onError=="function"){e.onError({error_message:"incomplete parameters"})}throw new Error("incomplete parameter")}return this}};n.Query.setCachePolicy=function(e){s=e;return n};n.Query.CachePolicy={ONLY_CACHE:"only_cache",ONLY_NETWORK:"only_network",CACHE_ELSE_NETWORK:"cache_else_network",NETWORK_ELSE_CACHE:"network_else_cache",CACHE_THEN_NETWORK:"cache_then_network"}})(r);(function(e){var t=e;t.Location=function(e){var n={longitude:0,latitude:0};var r=function(e,t){if(typeof e!="number"||typeof t!="number"){throw new Error("invalid data type")}if(t<-90||t>90){throw new Error("invalid value for latitude: "+t)}if(e<-180||e>180){throw new Error("invalid value for longitude: "+e)}};if(t.Util.dataType(e)=="object"){if(e.longitude&&e.longitude){r(e.longitude,e.longitude);n.longitude=e.longitude;n.latitude=e.latitude}}else if(t.Util.dataType(e)=="array"){if(e.length>=2){r(e[0],e[1]);n.longitude=e[0];n.latitude=e[1]}}else if(arguments.length>=2){r(arguments[0],arguments[1]);n.longitude=arguments[0];n.latitude=arguments[1]}this.getRadians=function(e){if(e instanceof t.Location){var r=e.toJSON();var i=Math.PI/180,s=n.latitude*i,o=n.longitude*i,u=r.latitude*i,a=r.longitude*i,f=s-u,l=o-a,c=Math.sin(f/2),h=Math.sin(l/2);var p=c*c+Math.cos(s)*Math.cos(u)*h*h;p=Math.min(1,p);return 2*Math.asin(Math.sqrt(p))}else{throw new Error("Built.Location object required")}};this.setLocation=function(e,t){if(typeof e=="number"&&typeof t=="number"){r(e,t);n.longitude=e;n.latitude=t}return this};this.kilometersFrom=function(e){return this.getRadians(e)*6371},this.milesFrom=function(e){return this.getRadians(e)*3958.8};this.toJSON=function(){return{longitude:n.longitude,latitude:n.latitude}}};t.Location.getCurrentLocation=function(e){e=e||{};var n=b(e);e=n.__options;if(typeof navigator!=="undefined"&&typeof navigator.geolocation!=="undefined"){navigator.geolocation.getCurrentPosition(function(n){if(typeof e.onSuccess=="function"){e.onSuccess(new t.Location({latitude:n.coords.latitude,longitude:n.coords.longitude}))}},function(t){if(typeof e.onError=="function"){e.onError({error_message:t.message,code:t.code,object:t})}})}else{if(typeof e.onError=="function"){e.onError({error_message:"Geo functionality is not supported by the platform"})}}return n}})(r);(function(e){var t=e;t.Role={class_uid:"built_io_application_user_role",setName:function(e){if(typeof e=="string"&&e!=""){return this.set("name",e)}return this},getName:function(){return this.get("name")},setRoleUid:function(e){if(typeof e=="string"&&e!=""){return this.set("uid",e)}return this},getRoleUid:function(e){return this.get("uid")},addUser:function(e){var t;if(typeof e=="object"&&typeof e.uid=="string"){t=e.uid}else if(typeof e=="string"){t=e}if(t){var n=this.get("users")||[];for(var r=0;r<n.length;r++){if(t==n[r]){return this}}n.push(t);this.set("users",n)}return this},removeUser:function(e){var t;if(typeof e=="object"){if(e.uid){t=e.uid}}else if(typeof e=="string"){t=e}if(t){var n=this.get("users")||[];for(var r=0;r<n.length;r++){if(t==n[r]){n.splice(r,1);this.set("users",n)}}}return this},addRole:function(e){var t;if(typeof e=="object"&&typeof e.uid=="string"){t=e.uid}else if(typeof e=="string"){t=e}if(t){var n=this.get("roles")||[];for(var r=0;r<n.length;r++){if(t==n[r]){return this}}n.push(t);this.set("roles",n)}return this},removeRole:function(e){var t;if(typeof e=="object"&&typeof e.uid=="string"){t=e.uid}else if(typeof user=="string"){t=e}if(t){var n=this.get("roles")||[];for(var r=0;r<n.length;r++){if(t==n[r]){n.splice(r,1);this.set("roles",n)}}}return this},hasUser:function(e){if(e){var t=this.get("users")||[];if(t.indexOf(e)>=0){return true}}return false},hasRole:function(e){if(e){var t=this.get("roles")||[];if(t.indexOf(e)>=0){return true}}return false},getUsers:function(){return this.get("users")||[]},getRoles:function(){return this.get("roles")||[]}};t.Role=y.call(t.Object,t.Role)})(r);(function(e){var t=e;t.Promise=function(){var e=[],n=[],r=[],i=false,s=false,o=[],u,a=false,f=false;this.success=function(t,n){if(typeof t=="function"){n=n||this;if(s){u=t.apply(n,o);e=[]}e.push({callback:t,context:n})}return this};this.error=function(e,t){if(typeof e=="function"){t=t||this;if(i){u=e.apply(t,o);n=[]}n.push({callback:e,context:t})}return this};this.always=function(e,t){if(typeof e=="function"){t=t||this;if(i||s){e.apply(t,o);r=[]}r.push({callback:e,context:t})}return this};this.resolve=function(){if((s||i)&&a===false){return this}s=true;o=Array.prototype.slice.call(arguments);for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r){try{u=r.callback.apply(r.context,o)}catch(c){f=true;u=c}}}if(!a){e=[]}l();return this};this.reject=function(){if((i||s)&&a===false){return this}i=true;o=Array.prototype.slice.call(arguments);for(var e=0,t=n.length;e<t;e++){var r=n[e];if(r){try{u=r.callback.apply(r.context,o)}catch(c){f=true;u=c}}}if(!a){n=[]}l();return this};this.isFulfilled=function(){return s||i};this.then=function(r,i){var s=new t.Promise;if(typeof r!=="function"&&e.length>0&&typeof e[0]=="object"){r=e.shift().callback}if(typeof i!=="function"&&n.length>0&&typeof e[0]=="object"){i=n.shift().callback}var o=function(e,n){if(e&&t.Promise.isPromise(e)){e.then(function(){s.resolve.apply(s,arguments)},function(){s.reject.apply(s,arguments)})}else{if(n||f){s.reject.call(s,e)}else{s.resolve.call(s,e)}}};var a=function(){var e=arguments;if(typeof r==="function"){try{o(r.apply(this,e))}catch(t){o(t,true)}}else{o(u)}};var l=function(){var e=arguments;if(typeof i==="function"){try{o(i.apply(this,e))}catch(t){o(t,true)}}else{o(u,true)}};this.success(a);this.error(l);return s};var l=function(){for(var e=0,t=r.length;e<t;e++){var n=r[e];if(n){n.callback.apply(n.context,o)}}if(!a){r=[]}};this.__preserve=function(e){if(typeof e==="boolean"){a=e}}};t.Promise.when=function(){var e=[];for(var n in arguments){if(t.Util.dataType(arguments[n])=="array"){e=e.concat(arguments[n])}else if(typeof arguments[n]=="object"){e.push(arguments[n])}}var r=e.length;var i=new t.Promise;if(r==0){i.resolve();return i}var s=r;var o=[];var u=[];var a=false;var f=function(){--s;if(s===0){if(a){i.reject(o,u)}else{i.resolve(u)}}};t.Util.each(e,function(e,n){if(t.Promise.isPromise(e)){e.then(function(e){u[n]=e;f()},function(e){o[n]=e;u[n]=e;a=true;f()})}else{u[n]=e;f()}});return i};t.Promise.isPromise=function(e){return typeof e==="object"&&typeof e.then==="function"}})(r);(function(e){var t=e;t.Application={};t.Application.fetchSettings=function(e){e=e||{};var t=b(e);e=t.__options;var n=function(t,n){try{t=JSON.parse(t)}catch(r){}if(typeof t=="object"&&typeof t.application!=="undefined"){if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};var r=w.APP_SETTINGS.fetch(h,{include_application_variables:true},n);t._XHR=r._XHR;t.abort=r.abort;return t};t.Application.fetchUsers=function(){return new t.Query("built_io_application_user")};t.Application.fetchRoles=function(){return new t.Query("built_io_application_user_role")}})(r);(function(e){var t=e;t.Extension={};t.Extension.execute=function(e,t,r){var i=h["application_api_key"];r=r||{};var s=b(r);r=s.__options;if(typeof i=="string"&&i!=""&&typeof e=="string"&&typeof r=="object"){t=t||{};if(t==null||typeof t!="object"){t={}}var o=m(n.extensionURL+e);var u={application_api_key:i};var a=function(e,t){if(t.status==200){if(typeof r.onSuccess=="function"){r.onSuccess(e,t)}}else if(typeof r.onError=="function"){r.onError(e,t)}};var f=E(o,u,t,a);s._XHR=f._XHR;s.abort=f.abort}else{if(typeof r=="function"){r({error_message:"parameter missing"},null)}}return s};t.Extension.define=function(e,t){return this};t.Extension.beforeSave=function(e,t){return this};t.Extension.afterSave=function(e,t){return this};t.Extension.http={get:function(){},put:function(){},del:function(){},post:function(){}}})(r);(function(e){var t=e;t.Analytics={};t.Analytics.Event=function(e){var n=e||"";var r=[];var i={};this.addAttributes=function(e,t,n){if(typeof e=="object"){var i={properties:e};if(typeof t=="string"){i["previous_event_uid"]=t}if(n instanceof Date&&typeof n.toISOString=="function"){i["created_at"]=n.toISOString()}r.push(i);return this}throw new Error("object required")};this.setUid=function(e){if(typeof e=="string"){n=e}return this};this.trigger=function(e){if(n!=""){e=e||{};var t=this.toJSON();var s=b(e);e=s.__options;var o=function(t,n){try{t=JSON.parse(t)}catch(s){}if(typeof t.notice!=="undefined"){r=[];i={};if(typeof e.onSuccess=="function"){e.onSuccess(t,n)}}else{if(typeof e.onError=="function"){e.onError(t,n)}}};var u=w.AS.trigger(h,t,o);s._XHR=u._XHR;s.abort=u.abort;return s}throw new Error("event uid required, use setUid method to set event uid")};this.appendEvent=function(e){if(e instanceof t.Analytics.Event&&typeof e.toJSON=="function"){var n=e.toJSON();if(n.events){for(var r in n.events){if(i[r]&&i[r].length){i[r]=i[r].concat(n.events[r])}else{i[r]=n.events[r]}}}}else{throw new Error("Built.Analytics.Event object required")}return this};this.toJSON=function(){if(n!=""){var e={};e[n]=r;e=t.Util.mix(e,i);return{events:e}}return null}}})(r);(function(e){var t=e;t.Notification=function(){var e={msg:"",time:"",users:[],local:false};this.setMessage=function(t){if(typeof t=="string"){e.msg=t}else{throw new Error("invalid message type")}return this};this.atTime=function(t){if(t instanceof Date){e.time=t.toISOString()}else{throw new Error("JavaScript date object required")}return this};this.addUsers=function(n){if(typeof n=="string"){e.users.push(n)}else if(t.Util.dataType(n)=="array"){e.users=e.users.concat(n)}return this};this.inLocalTime=function(t){if(typeof t=="boolean"){e.local=t}};this.send=function(t){if(e.msg!=""&&e.users.length>0){t=t||{};var n=b(t);t=n.__options;var r={push:{message:e.msg}};if(e.time!=""){r.push.send_at=e.time;r.push.local_push=e.local}if(e.users.length>0){r.push.user_uids=e.users}var i=function(n,r){try{n=JSON.parse(n)}catch(i){}if(typeof n.notice!=="undefined"){e.time="";e.msg="";e.local=false;e.users=[];if(typeof t.onSuccess=="function"){t.onSuccess(n,r)}}else{if(typeof t.onError=="function"){t.onError(n,r)}}};var s=w.NOTIFICATION.send(h,r,i);n._XHR=s._XHR;n.abort=s.abort;return n}else{throw new Error("message is not set or receivers not added")}}}})(r);(function(e){var t=e;t.Installation=function(){var e=new t.Object("built_io_installation_data",{});this.save=function(){if(!this.getDeviceToken()){return this}if(!e.get("uid")){e.upsert("device_token",this.getDeviceToken())}return e.save.apply(e,arguments)};this.destroy=function(){return e.destroy.apply(e,arguments)};this.fetch=function(){try{return e.fetch.apply(e,arguments)}catch(t){throw new Error("installation uid required")}};this.set=function(){e.set.apply(e,arguments);return this};this.get=function(t){return e.get(t)};this.setTimeZone=function(){var t=(new Date).getTimezoneOffset();var n=Math.abs(t)<60?(t<0?"+":"-")+"0:"+Math.abs(t):(t<0?"+":"-")+(Math.floor(Math.abs(t)/60)+":"+Math.abs(t)%60);e.set("timezone",n);return this};this.setLocation=function(){e.setLocation.apply(e,arguments);return this};this.setDeviceToken=function(t){e.set("device_token",t);return this};this.setInstallationId=function(t){e.set("uid",t);return this};this.setDeviceType=function(t){e.set("device_type",t);return this};this.subscribeChannels=function(n){if(typeof n=="string"&&n!=""||t.Util.dataType(n)=="array"){e.pushValue("subscribed_to_channels",n)}return this};this.unsubscribeChannels=function(n){if(typeof n=="string"&&n!=""||t.Util.dataType(n)=="array"){e.pullValue("subscribed_to_channels",n)}return this};this.getDeviceToken=function(){return e.get("device_token")};this.getDeviceType=function(){return e.get("device_type")};this.getSubscribedChannelList=function(){return e.oldJSON()["subscribed_to_channels"]||[]};this.toJSON=function(){return e.toJSON()};this.dirtyJSON=function(){return e.dirtyJSON()};this.oldJSON=function(){return e.oldJSON()}}})(r);var w={OBJECT:{create:function(e,t,r,i){e=e||{};i=i||{};if(i.class_uid&&e.application_api_key&&e.application_uid){var s=n.Base+n.classes+i.class_uid+n.objects;s=m(s);return E(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},fetch:function(e,t,r,i){e=e||{};i=i||{};if(i.class_uid&&e.application_api_key&&e.application_uid){var s=n.Base+n.classes+i.class_uid+n.objects+(i.object_uid?i.object_uid:"");s=m(s);return S(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},update:function(e,t,r,i){e=e||{};i=i||{};if(i.class_uid&&i.object_uid&&e.application_api_key&&e.application_uid){var s=n.Base+n.classes+i.class_uid+n.objects+i.object_uid;s=m(s);return T(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},destroy:function(e,t,r,i){e=e||{};i=i||{};if(i.class_uid&&i.object_uid&&e.application_api_key&&e.application_uid){var s=n.Base+n.classes+i.class_uid+n.objects+i.object_uid;s=m(s);return x(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this}},CLASS:{fetch:function(e,t,r,i){e=e||{};i=i||{};if(i.class_uid&&e.application_api_key&&e.application_uid){var s=n.Base+n.classes+i.class_uid;s=m(s);return S(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this}},file:{upload:function(e,t,r,i){e=e||{};i=i||{};if(i.class_uid&&e.application_api_key&&e.application_uid){var s=n.Base+n.upload;s=m(s);return E(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this}},USER:{login:function(e,t,r,i){e=e||{};if(e.application_api_key&&e.application_uid){var s=n.Base+"/"+n.login;s=m(s);return E(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},logout:function(e,t,r,i){e=e||{};if(e.application_api_key&&e.application_uid&&e.authtoken){var s=n.Base+"/"+n.logout;s=m(s);return x(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},fetchUserInfo:function(e,t,r,i){e=e||{};if(e.application_api_key&&e.application_uid&&e.authtoken){var s=n.Base+"/"+n.getUserInfo;s=m(s);return S(s,e,{},r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},register:function(e,t,r,i){e=e||{};if(e.application_api_key&&e.application_uid){var s=n.Base+"/"+n.user;s=m(s);return E(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},forgetPassword:function(e,t,r,i){e=e||{};t=t||{};if(e.application_api_key&&e.application_uid&&t.application_user&&t.application_user.email){var s=n.Base+n.forgetPassword;s=m(s);return E(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},activate:function(e,t,r,i){e=e||{};t=t||{};i=i||{};if(e.application_api_key&&e.application_uid&&i.userId&&i.activationToken){var s=n.Base+"/application/users/"+i.userId+"/activate/"+i.activationToken;s=m(s);return S(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},deactivate:function(e,t,r,i){e=e||{};t=t||{};i=i||{};if(e.application_api_key&&e.application_uid&&e.authtoken&&i.userId){var s=n.Base+"/application/users/"+i.userId;s=m(s);return x(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},fetchUidByEmail:function(e,t,r){e=e||{};t=t||{};if(e.application_api_key&&e.application_uid){var i=n.Base+"/application/users/retrieve_user_uid";i=m(i);return E(i,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},update:function(e,t,r,i){e=e||{};i=i||{};if(e.application_api_key&&e.application_uid&&e.authtoken&&i.uid){var s=n.Base+"/"+n.user+i.uid;s=m(s);t={application_user:t};return T(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this}},AS:{trigger:function(e,t,r){var i=n.Base+"/events/trigger_multiple";i=m(i);e=e||{};t=t||{};if(e.application_api_key&&e.application_uid){return E(i,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this}},APP_SETTINGS:{fetch:function(e,t,r){e=e||{};r=r||{};if(e.application_api_key&&e.application_uid){var i=n.Base+"/applications/"+e.application_uid;i=m(i);return S(i,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this}},UPLOAD:{fetch:function(e,t,r,i){e=e||{};i=i||{};if(e.application_api_key&&e.application_uid&&i.uid){var s=n.Base+n.upload+i.uid;s=m(s);return S(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},destroy:function(e,t,r,i){e=e||{};i=i||{};if(e.application_api_key&&e.application_uid&&i.uid){var s=n.Base+n.upload+i.uid;s=m(s);return x(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this},save:function(e,t,r,i){e=e||{};i=i||{};if(e.application_api_key&&e.application_uid&&i.uid){var s=n.Base+n.upload+i.uid;s=m(s);return E(s,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}return this}},NOTIFICATION:{send:function(e,t,r){e=e||{};if(e.application_api_key&&e.application_uid){var i=n.Base+n.notification;i=m(i);return E(i,e,t,r)}else{if(typeof r=="function"){r({error_message:"provide all parameters"})}}}}};var E=function(e,t,n,r){return u(e,t,n,"POST",r)};var S=function(e,t,n,r){return u(e,t,n,"GET",r)};var x=function(e,t,n,r){return u(e,t,n,"DELETE",r)};var T=function(e,t,n,r){return u(e,t,n,"PUT",r)};var N=function(e,t,i,s,o){if(n.host==""||typeof n.host!=="string"||n.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}if(typeof o!="function"){o=function(){}}s=s.toUpperCase();i=i||{};t=t||{};if(typeof XDomainRequest!=="undefined"){return C(e,t,i,s,o)}try{var u=new XMLHttpRequest;if(s!="POST"){i["_method"]=s;s="POST"}u.open(s,e,true);u.setRequestHeader("Content-Type","application/json");if(r.Util.dataType(t)=="object"){for(var a in t){u.setRequestHeader(a,t[a])}}i=JSON.stringify(i);u.onreadystatechange=function(n){if(u.readyState==4){if(u.status!=0){o(u.responseText,u)}else if(u["__aborted__"]==false&&d){try{i=JSON.parse(i)}catch(n){}var s=i["_method"];try{delete i._method}catch(n){}l=true;C(e,t,i,s,o)}else if(u["__aborted__"]){var a={error_message:"request aborted",http:u};o(a,u)}r.Events.trigger("http:end")}};u.ontimeout=u.onerror=function(e){r.Events.trigger("http:end");var t={error_message:"http client error",http:u,event:e};o(t,u);o=function(){}};u.__aborted__=false;u.send(i);r.Events.trigger("http:start");return{_XHR:true,abort:function(){r.Events.trigger("http:end");u.__aborted__=true;u.abort()}}}catch(f){l=true;return C(e,t,i,s,o)}};var C=function(e,t,n,i,s){try{n=JSON.parse(n)}catch(o){}try{delete n._method}catch(o){}var u=v().toString();if(typeof r.cbTray!="object"){r.cbTray={}}r.cbTray[u]=s;var a=k(e,t,n,i,u);var f=L(e,t,n,i,u);f.submit();r.Events.trigger("http:start");return function(e){return{_XHR:false,abort:function(){if(typeof r.cbTray[e]==="function"){r.Events.trigger("http:end");r.cbTray[e]=function(){try{delete r.cbTray[e]}catch(t){}};try{var t=document.getElementById("frame_"+e);t.parentNode.removeChild(t)}catch(n){}try{var i=document.getElementById("form_"+e);i.parentNode.removeChild(i)}catch(n){}}}}}(u)};var k=function(e,t,r,i,s){if(n.host==""||typeof n.host!=="string"||n.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}try{i=i.toUpperCase()}catch(o){i="POST"}var u=A("frame_"+s);u.setAttribute("width","0");u.setAttribute("height","0");u.setAttribute("style","display:none");document.body.appendChild(u);return u};var L=function(e,t,r,i,s){if(n.host==""||typeof n.host!=="string"||n.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}try{i=i.toUpperCase()}catch(o){i="POST"}var u=document.createElement("form");u.setAttribute("id","form_"+s);u.setAttribute("target","frame_"+s);u.setAttribute("method","post");if(e.charAt(e.length-1)=="/"){e=e.substring(0,e.length-1)}e=e+".postmessage";u.setAttribute("action",e);for(var a in t){try{u.appendChild(O(a.toString().toUpperCase(),t[a]))}catch(o){}}r=r||{};var f=typeof r=="object"?JSON.stringify(r):r;u.appendChild(O("PARAM",f));u.appendChild(O("postmessage_payload",s));u.appendChild(O("_method",i));u.appendChild(O("host",document.location.origin?document.location.origin:document.location.protocol+"//"+document.location.host));document.body.appendChild(u);return u};var A=function(e){var t;try{t=document.createElement('<iframe name="'+e+'" id="'+e+'" />')}catch(n){t=document.createElement("iframe");t.id=e;t.name=e}return t};var O=function(e,t){var n;try{n=document.createElement('<input type="hidden" name="'+e+'" />')}catch(r){n=document.createElement("input");n.type="hidden";n.name=e}n.value=t;return n};var M=function(){var e=function(e){var t=e.data?e.data:e.message;try{t=JSON.parse(t)}catch(e){}if(typeof t=="object"&&t.postmessage_payload){var n=t.postmessage_payload;try{delete t["postmessage_payload"]}catch(e){}r.Events.trigger("http:end");if(typeof r.cbTray[n]=="function"){r.cbTray[n](t,{type:"NETWORK"});try{delete r.cbTray[n]}catch(e){}try{var i=document.getElementById("frame_"+n);i.parentNode.removeChild(i)}catch(e){}try{var s=document.getElementById("form_"+n);s.parentNode.removeChild(s)}catch(e){}}else{}}else{}};if(typeof window.addEventListener!=="undefined"){window.addEventListener("message",e,false)}else{window.attachEvent("onmessage",e)}};if(c==false){M()}var _=function(e,t,i,s,o){if(n.host==""||typeof n.host!=="string"||n.host.length<=0){throw new Error("set host for built.io server. eg: Built.setURL('built.io')");return}t=t||{};s=s.toUpperCase();i=i||{};if(g(p)==false){var u=r.Util.param(p);e+="?"+u}if(s!="POST"){i["_method"]=s.toUpperCase();s="POST"}t["Content-Type"]="application/json";i=JSON.stringify(i);return a.post({url:e,headers:t,body:i,json:true},function(e,t,n){r.Events.trigger("http:end");o(n?n:e,t)});r.Events.trigger("http:start")};if(c){u=_}else{u=N}var D={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,i,s,o,u,a="",f=0;for(e=D._utf8_encode(e);e.length>f;)t=e.charCodeAt(f++),n=e.charCodeAt(f++),r=e.charCodeAt(f++),i=t>>2,s=(3&t)<<4|n>>4,o=(15&n)<<2|r>>6,u=63&r,isNaN(n)?o=u=64:isNaN(r)&&(u=64),a=a+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u);return a},decode:function(e){var t,n,r,i,s,o,u,a="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");e.length>f;)i=this._keyStr.indexOf(e.charAt(f++)),s=this._keyStr.indexOf(e.charAt(f++)),o=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),t=i<<2|s>>4,n=(15&s)<<4|o>>2,r=(3&o)<<6|u,a+=String.fromCharCode(t),64!=o&&(a+=String.fromCharCode(n)),64!=u&&(a+=String.fromCharCode(r));return a=D._utf8_decode(a)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;e.length>n;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(192|r>>6),t+=String.fromCharCode(128|63&r)):(t+=String.fromCharCode(224|r>>12),t+=String.fromCharCode(128|63&r>>6),t+=String.fromCharCode(128|63&r))}return t},_utf8_decode:function(e){for(var t="",n=0,r=c1=c2=0;e.length>n;)r=e.charCodeAt(n),128>r?(t+=String.fromCharCode(r),n++):r>191&&224>r?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}};var P={get:function(e){if(typeof localStorage!=="undefined"){return localStorage.getItem(e)||null}return null},set:function(e,t){if(typeof localStorage!=="undefined"&&e){return localStorage.setItem(e,t)}return null}};if(typeof define==="function"&&define.amd){define("Built",[],function(){return r})}})(typeof window==="undefined"?this:window)